name: Python CI

on: [push]

jobs:
  bot:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout codes'
        uses: actions/checkout@v3
      
      - name: '安装Python环境'
        uses: 'actions/setup-python@v3'
        with: 
            python-version: 3.9
        
      - name: "配置依赖"
        run: pip install -r requirements.txt
        #run: pip install requests
      - name: "数据抓取测试"
        run: python3 ./01.Python/test.py
      
      - name: '生成当前文件列表'
        run: bash ./listdir.sh
      - name: 'Send filelist mail'
        uses: dawidd6/action-send-mail@v3.6.1
        with:
          server_address: smtp.139.com
          server_port: 465
          username: ${{ secrets.EMAIL_139_USER_NAME }}
          password: ${{ secrets.EMAIL_139_USER_PWD }}
          subject: the file list about the compile
          body: Github Action Send File List
          html_body: file://file_list.html
          #html_body: file://01.Python/2022_05_11.html
          #to: tp232fs234@chacuo.net
          to: 1379126606@qq.com
          from: GitHub Actions
       
      - name: 'Send content mail'
        uses: dawidd6/action-send-mail@v3.6.1
        with:
          server_address: smtp.139.com
          server_port: 465
          username: ${{ secrets.EMAIL_139_USER_NAME }}
          password: ${{ secrets.EMAIL_139_USER_PWD }}
          subject: python script result 
          body: github action send email test!!!!
          #html_body: file://file_list.html
          html_body: file://2022_05_11.html
          #to: tp232fs234@chacuo.net
          to: 1379126606@qq.com
          from: GitHub Actions